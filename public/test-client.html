<!doctype html>
<html>
  <head>
    <title>Test Client - World of Word</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      .btn {
        padding: 10px 15px;
        margin: 5px;
        cursor: pointer;
        border: none;
        border-radius: 4px;
      }
      .btn-primary {
        background: #007bff;
        color: white;
      }
      .btn-danger {
        background: #dc3545;
        color: white;
      }
      .btn-warning {
        background: #ffc107;
        color: black;
      }
      .output {
        background: #f5f5f5;
        padding: 10px;
        height: 300px;
        overflow-y: auto;
        font-family: monospace;
        border: 1px solid #ddd;
      }
      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
      }
      .status.connected {
        background: #d4edda;
        color: #155724;
      }
      .status.disconnected {
        background: #f8d7da;
        color: #721c24;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ§ª Test Client - World of Word</h1>

    <div id="status" class="status disconnected">DÃ©connectÃ©</div>

    <div>
      <button class="btn btn-primary" onclick="connect()">Connect</button>
      <button class="btn btn-danger" onclick="disconnect()">Disconnect</button>
      <button class="btn btn-primary" onclick="sendTestMessage()">Send Test Message</button>
      <button class="btn" onclick="clearOutput()">Clear</button>
    </div>

    <div class="output" id="output"></div>

    <script>
      let socket = null;
      let messageCount = 0;

      function updateStatus(connected) {
        const status = document.getElementById('status');
        if (connected) {
          status.className = 'status connected';
          status.textContent = `ConnectÃ© avec ID: ${socket?.id || 'unknown'}`;
        } else {
          status.className = 'status disconnected';
          status.textContent = 'DÃ©connectÃ©';
        }
      }

      function log(message, type = 'info') {
        const output = document.getElementById('output');
        const time = new Date().toLocaleTimeString();
        const emoji =
          type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : type === 'warning' ? 'âš ï¸' : 'ğŸ“';
        output.innerHTML += `[${time}] ${emoji} ${message}<br>`;
        output.scrollTop = output.scrollHeight;
      }

      function connect() {
        if (socket) {
          log('DÃ©jÃ  connectÃ© !', 'warning');
          return;
        }

        socket = io('http://localhost:3002');

        socket.on('connect', () => {
          log(`ConnectÃ© avec succÃ¨s ! ID: ${socket.id}`, 'success');
          updateStatus(true);
        });

        socket.on('disconnect', () => {
          log('DÃ©connectÃ© du serveur', 'error');
          updateStatus(false);
          socket = null;
        });

        socket.on('welcome', (data) => {
          log(`ğŸ‰ Message de bienvenue: ${data.message}`);
        });

        socket.on('cooldownViolation', (data) => {
          log(
            `âš ï¸ COOLDOWN VIOLATION: ${data.reason} (${data.remainingCooldown}s restant)`,
            'warning',
          );
        });

        socket.on('cooldownActive', (data) => {
          log(`â±ï¸ COOLDOWN ACTIF: ${data.reason} (${data.remainingCooldown}s restant)`, 'warning');
        });

        socket.on('rateLimitExceeded', (data) => {
          log(`ğŸš« RATE LIMIT EXCEEDED: ${data.reason} (retry in ${data.retryAfter}s)`, 'error');
        });

        socket.on('testResponse', (data) => {
          log(`ğŸ“¨ RÃ©ponse test: ${data.message}`);
        });

        socket.on('spamResponse', (data) => {
          log(`ğŸ’¥ RÃ©ponse spam: ${data.message}`);
        });

        socket.on('pong', (data) => {
          log(`ğŸ“ Pong reÃ§u de ${data.clientId}`);
        });

        socket.on('error', (data) => {
          log(`âŒ Erreur serveur: ${JSON.stringify(data)}`, 'error');
        });
      }

      function disconnect() {
        if (socket) {
          socket.disconnect();
          socket = null;
          updateStatus(false);
          log('ğŸ”Œ DÃ©connectÃ© manuellement');
        } else {
          log('Pas connectÃ© !', 'warning');
        }
      }

      function sendTestMessage() {
        if (!socket) {
          log('âŒ Pas connectÃ© !', 'error');
          return;
        }

        messageCount++;
        const message = {
          test: `Hello from test client #${messageCount}!`,
          timestamp: Date.now(),
          count: messageCount,
        };

        socket.emit('testMessage', message);
        log(`ğŸ“¤ Message de test envoyÃ© #${messageCount}`);
      }

      function spamMessages() {
        if (!socket) {
          log('âŒ Pas connectÃ© !', 'error');
          return;
        }

        log('ğŸ’¥ DÃ©but du spam (10 messages en 500ms)...', 'warning');

        for (let i = 0; i < 10; i++) {
          setTimeout(() => {
            messageCount++;
            socket.emit('spamTest', {
              spam: `Spam message ${i + 1}/10`,
              timestamp: Date.now(),
              total: messageCount,
            });
            log(`ğŸ“¤ Spam ${i + 1}/10 envoyÃ©`);
          }, i * 50); // 50ms entre chaque message
        }
      }

      function superSpam() {
        if (!socket) {
          log('âŒ Pas connectÃ© !', 'error');
          return;
        }

        log('ğŸ’¥ğŸ’¥ SUPER SPAM (20 messages en 100ms)...', 'warning');

        for (let i = 0; i < 20; i++) {
          setTimeout(() => {
            messageCount++;
            socket.emit('spamTest', {
              superSpam: `Super spam ${i + 1}/20`,
              timestamp: Date.now(),
              total: messageCount,
            });
            log(`ğŸ“¤ Super spam ${i + 1}/20 envoyÃ©`);
          }, i * 5); // 5ms entre chaque message = trÃ¨s rapide !
        }
      }

      function clearOutput() {
        document.getElementById('output').innerHTML = '';
        messageCount = 0;
        log('ğŸ§¹ Output effacÃ©');
      }

      // Auto-connect au chargement
      window.addEventListener('load', () => {
        updateStatus(false);
        log('ğŸš€ Test client chargÃ©. Cliquez sur "Connect" pour commencer.');
      });
    </script>
  </body>
</html>
